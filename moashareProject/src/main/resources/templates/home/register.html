<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>회원가입</title>
<link rel="stylesheet" href="../css/register.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script type="text/javascript">
var check = 0;	
	$(function(){		
		$("#btnnicknameck").on("click", nicknameDuplicateCk); // 아이디중복체크
		$("#btnemailck").on("click", emailDuplicateCk); // 이메일 아이디 중복체크
		$("#btnemailverifty").on("click", emailVerifyCk); // 이메일 인증체크
		$("#btnfinck").on("click", finalCk); // 유효성검사
		$("select").on("change", selectEmail); // 이메일도메인
	});
	function emailDuplicateCk(){ 
		console.log("버튼눌림");
		var email1 = $("#email1").val().trim(); 
		var email2 = $("#email2").val().trim();
		var email = email1+'@'+email2;
		console.log(email);
		// 확인
		if( email1 == ''){
			alert("이메일 앞자리를 입력하십시오"); 
			$("#email1").focus();
			return false;
		}else if( email2 == ''){
			alert("이메일 뒷자리를 입력하십시오"); 
			$("#email2").focus();
			return false;
		}else {
			$.ajax({
				url : '../register/emailCk',
				type : 'post',
				data : { email : email },
				success : function(confirm){ 
					var confirm=confirm; 
					if ( confirm == 1 ){
						check = 1; 
						$("#emailError").html("이메일이 존재합니다").css('color','red'); 				
					} else {
						check = 2; 
						$("#emailError").html("이메일이 사용가능합니다").css('color','green'); 
					}
				},
				error : function(){
					alert("서버요청실패");
				}
			})			
		}	
		
	}
	function nicknameDuplicateCk(){ 
		var nickname = $("#usernickname").val().trim();
		if( nickname == ''){
			alert("닉네임을 입력하십시오"); 
			$("#nickname").focus();
			return false;
		}else {
			$.ajax({
				url : '../register/nicknameCk',
				type : 'post',
				data : { nickname : nickname },
				success : function(confirm){ 
					var confirm = confirm; 
					if ( confirm == 1 ){
						check = 1; 
						$("#nicknameError").html("닉네임이 존재합니다").css('color','red'); 				
					} else {
						check = 2; 
						$("#nicknameError").html("닉네임이 사용가능합니다").css('color','green'); 
					}
				},
				error : function(){
					alert("서버요청실패");
				}
			})			
		}		
	}
	function emailVerifyCk(){
		var email1 = $("#email1").val(); 
		var email2 = $("#email2").val();
		var email = email1+'@'+email2;
		var codeInput = $("#emailverification").val();
		console.log(email);
		verificationError
		$.ajax({
			url : '../register/emailVerify',
			type : 'get',
  			data : { email : email },
			success : function (data) {
				console.log("data : " +  data);
//				codeInput.attr('disabled',false);
				code=data;
				alert('인증번호가 전송되었습니다.');
			}			
		});
	}
	function selectEmail(){
		//console.log("클릭"); 
		$("#selectEmail option:selected").each(function () {			
			if($(this).val()== '1'){ 
				$("#email2").val('');
				$("#email2").attr("disabled",false);
			}else{
				$("#email2").val($(this).text());
				$("#email2").attr("disabled",true);
			}
		});
	}
	function finalCk(){
		//console.log("버튼눌림"); 
		var email1 = $("#email1").val(); 
		var email2 = $("#email2").val();
		var pwd = $("#userpw").val();
		var repwd = $("#userrepw").val();
		var nickname = $("#username").val();
		
		var pwdPattern = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{6,15}$/;//6~15자 영문,숫자,특수문자 1개 이상 필수

	
		document.frm.submit(); 
	}
</script>
</head>
<body>
	<div class="wrapper" id="div1">
		<div class="registerTitle"><h1 style="font-size: 30px;">회원가입</h1></div>
		<form th:action="@{/login}" method="post">
		<div id="registerInfo">
			<div id="div2" class="pad">
				<label>이메일*</label>
				<input type="text" name="email1" id="email1" placeholder="이메일" /> @
				<input type="text" name="email2" id="email2" placeholder="이메일도메인" />
				<select name="selectEmail" id="selectEmail">
					<option value="1" selected>직접입력</option>
					<option value="naver.com">naver.com</option>
					<option value="daum.net">daum.net</option>
					<option value="gmail.com">gmail.com</option>
					<option value="nate.com">nate.com</option>
					<option value="yahoo.co.kr">yahoo.co.kr</option>
					<option value="korea.com">korea.com</option>
					<option value="hotmail.com">hotmail.com</option>
				</select>
				<input type="button" id="btnemailck" class="btn" value="중복확인" />
				<div id="emailError" class="error"></div>
			</div>
			<div id="div3" class="pad">
	            <label>본인인증*</label>
				<input type="text" name="emailverification" id="emailverification" placeholder="본인인증 코드를 입력하세요"/>
				<input type="button" id="btnemailverifty" class="btn" value="인증코드 받기" />
				<div id="verificationError" class="error"></div>
			</div>
			<div id="div4" class="pad">
	            <label>닉네임*</label>
				<input type="text" name="usernickname" id="usernickname" placeholder="8~15자 영문 또는 숫자만 사용 가능"/>
				<input type="button" id="btnnicknameck" class="btn" value="중복확인" />
				<div id="nicknameError" class="error"></div>
			</div>
			<div id="div5" class="pad">
				<label>비밀번호*</label>
				<input type="password" class="sameInput" name="userpw" id="userpw" placeholder="6~15자 영문,숫자,특수문자 1개 이상 필수"/>
			</div>
			<div id="div6" class="pad">
				<label>비밀번호 확인*</label>
				<input type="password" class="sameInput" name="userrepw" id="userrepw" placeholder="비밀번호 확인"/>
			</div>
			<div id="div7" style="clear:both; padding-top: 10px; box-sizing: border-box;">
				<input type="button" id="btnfinck" class="btn" value="회원가입"/>
			</div>
			</div>
		</form>
	</div>
</body>
</html>